<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Encrypt/Decrypt</title>
</head>
<body>
<h2>Secure Message Encryption/Decryption</h2>

<label>Password: <input type="password" id="password"></label>
<button id="startSession">Start Session</button>
<p id="sessionInfo"></p>

<label>Message: <input type="text" id="message"></label>
<button id="encryptBtn">Encrypt</button>
<button id="decryptBtn">Decrypt</button>

<p>Result: <span id="result"></span></p>

<script>
const serverUrl = 'https://your-server-domain.com';
let sessionId = null;

// Generate random session ID
function generateSessionId() {
    return crypto.randomUUID();
}

// Start session and store password securely on server
document.getElementById('startSession').addEventListener('click', async () => {
    const password = document.getElementById('password').value;
    if (!password) return alert('Enter a password');

    sessionId = generateSessionId();

    try {
        const res = await fetch(`${serverUrl}/store-password`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionId, password })
        });
        const data = await res.json();
        document.getElementById('sessionInfo').textContent = `Session started: ${sessionId}. Password stored securely.`;
        document.getElementById('password').value = ''; // clear from client memory
        setTimeout(() => { sessionId = null; document.getElementById('sessionInfo').textContent = 'Session expired'; }, 60 * 1000);
    } catch (err) {
        console.error(err);
        alert('Failed to start session');
    }
});

// Encrypt
document.getElementById('encryptBtn').addEventListener('click', async () => {
    const message = document.getElementById('message').value;
    if (!message || !sessionId) return alert('Enter a message and start session');

    try {
        const res = await fetch(`${serverUrl}/encrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionId, message })
        });
        const data = await res.json();
        if (data.error) alert(data.error);
        else document.getElementById('result').textContent = data.result;
    } catch (err) {
        console.error(err);
        alert('Encryption failed');
    }
});

// Decrypt
document.getElementById('decryptBtn').addEventListener('click', async () => {
    const message = document.getElementById('message').value;
    if (!message || !sessionId) return alert('Enter a message and start session');

    try {
        const res = await fetch(`${serverUrl}/decrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionId, message })
        });
        const data = await res.json();
        if (data.error) alert(data.error);
        else document.getElementById('result').textContent = data.result;
    } catch (err) {
        console.error(err);
        alert('Decryption failed');
    }
});
</script>
</body>
</html>